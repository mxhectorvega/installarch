#!/usr/bin/env bash

# InstalaciÃ³n de paquetes flatpak para el usuario domÃ©stico.
# Repositorio: https://github.com/mxhectorvega/installarch
# EjecuciÃ³n: curl -L is.gd/mxflatpak | bash
# Fecha de actualizaciÃ³n: 04/02/2025
# VersiÃ³n: 5.0

# Colores ANSI
RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# FunciÃ³n para mostrar mensajes con formato
imprimir_mensaje() {
    local mensaje="$1"
    echo -e "\n\n\n\n\n\n\n\n\t\t\t\t\t\t\t$mensaje\n\n\n\n\n\n\n\n\n\n"
    sleep 3
}

# Verificar si flatpak estÃ¡ instalado, si no, instalarlo
if ! command -v flatpak &> /dev/null; then
    echo -e "${RED}Flatpak no estÃ¡ instalado. InstalÃ¡ndolo...${NC}"
    sudo pacman -S flatpak --noconfirm --needed
fi

# Agregar el repositorio flathub
if ! flatpak remote-list | grep -q flathub; then
    echo -e "${BLUE}Agregando el repositorio flathub...${NC}"
    flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
fi

# Definir las listas de paquetes
paquetes_gnome=(
    "fr.handbrake.ghb"
    "app.drey.Dialect"
    "page.tesk.Refine"
    "org.gnome.Showtime"
    "net.davidotek.pupgui2"
    "net.minetest.Minetest"
    "net.supertuxkart.SuperTuxKart"
    "com.github.KRTirtho.Spotube"
    "com.github.gabutakut.gabutdm"
    "com.github.iwalton3.jellyfin-media-player"
    "com.github.tchx84.Flatseal"
    "com.github.neithern.g4music"
    "com.spotify.Client"
    "com.mattjakeman.ExtensionManager"
    "com.obsproject.Studio"
    "com.rustdesk.RustDesk"
    "com.valvesoftware.Steam"
    "com.brave.Browser"
    "io.github.peazip.PeaZip"
    "io.gitlab.adhami3310.Impression"
    "io.missioncenter.MissionCenter"
    "io.itch.itch"
    "io.mrarm.mcpelauncher"
    "org.gnome.Evolution"
    "org.gnome.Calculator"
    "org.gnome.Connections"
    "org.gnome.Evince"
    "org.gnome.Loupe"
    "org.gnome.TextEditor"
    "org.gnome.gitlab.YaLTeR.VideoTrimmer"
    "org.gnome.gitlab.somas.Apostrophe"
    "org.audacityteam.Audacity"
    "org.gimp.GIMP"
    "org.inkscape.Inkscape"
    "org.jdownloader.JDownloader"
    "org.kde.kdenlive"
    "org.kde.krita"
    "org.libreoffice.LibreOffice"
    "org.pipewire.Helvum"
    "org.signal.Signal"
    "org.soundconverter.SoundConverter"
    "org.supertuxproject.SuperTux"
    "org.telegram.desktop"
)

paquetes_kde=(
    "fr.handbrake.ghb"
    "net.davidotek.pupgui2"
    "net.minetest.Minetest"
    "net.supertuxkart.SuperTuxKart"
    "com.github.KRTirtho.Spotube"
    "com.github.iwalton3.jellyfin-media-player"
    "com.spotify.Client"
    "com.obsproject.Studio"
    "com.rustdesk.RustDesk"
    "com.valvesoftware.Steam"
    "com.brave.Browser"
    "io.github.peazip.PeaZip"
    "io.itch.itch"
    "io.mrarm.mcpelauncher"
    "org.kde.klevernotes"
    "org.kde.isoimagewriter"
    "org.kde.CrowTranslate"
    "org.rncbc.qpwgraph"
    "org.kde.gwenview"
    "org.kde.okular"
    "org.kde.kcalc"
    "org.kde.ktorrent"
    "org.kde.kontact"
    "org.audacityteam.Audacity"
    "org.gimp.GIMP"
    "org.inkscape.Inkscape"
    "org.jdownloader.JDownloader"
    "org.kde.kdenlive"
    "org.kde.krita"
    "org.libreoffice.LibreOffice"
    "org.signal.Signal"
    "org.supertuxproject.SuperTux"
    "org.telegram.desktop"
)

# Paquete adicional
paquete_adicional="https://sober.vinegarhq.org/sober.flatpakref"

# Bucle para preguntar al usuario hasta que seleccione una opciÃ³n vÃ¡lida
while true; do
    echo -e "${CYAN}â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®${NC}"
    echo -e "${CYAN}â”‚                                                 â”‚${NC}"
    echo -e "${CYAN}â”‚ Â¿QuÃ© lista de paquetes flatpak deseas instalar? â”‚${NC}"
    echo -e "${CYAN}â”‚                                                 â”‚${NC}"
    echo -e "${CYAN}â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯${NC}"
    echo -e "${GREEN}1) Para entorno de escritorio GNOME (instalado con script minimal por mxhectorvega)${NC}"
    echo -e "${BLUE}2) Para entorno de escritorio KDE Plasma (instalado con archinstall desde archiso)${NC}"
    read -rp "Selecciona una opciÃ³n (1 o 2): " opcion

    # Validar la opciÃ³n seleccionada y proceder con la instalaciÃ³n
    if [ "$opcion" -eq 1 ]; then
        echo -e "${GREEN}Instalando paquetes de la Lista GNOME...${NC}"
        for paquete in "${paquetes_gnome[@]}"; do
            flatpak install --user -y "$paquete"
        done
        flatpak install --user -y "$paquete_adicional"
        echo -e "${GREEN}Â¡InstalaciÃ³n completada con Ã©xito!${NC}"
        break
    elif [ "$opcion" -eq 2 ]; then
        echo -e "${GREEN}Instalando paquetes de la Lista KDE...${NC}"
        for paquete in "${paquetes_kde[@]}"; do
            flatpak install --user -y "$paquete"
        done
        flatpak install --user -y "$paquete_adicional"
        echo -e "${GREEN}Instalando paquetes adicionales para permisos flatpak, capturador de pantalla y gestor de particiones GUI...${NC}"
        sudo pacman -Sy flatpak-kcm spectacle partitionmanager --noconfirm --needed
        echo -e "${GREEN}Â¡InstalaciÃ³n completada con Ã©xito!${NC}"
        break
    else
        echo -e "${RED}OpciÃ³n no vÃ¡lida. Por favor, selecciona una opciÃ³n vÃ¡lida.${NC}"
        echo -e "${RED}Â¡Error durante la instalaciÃ³n!${NC}"
    fi
done

# Mensaje final
echo -e "â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®"
echo -e "â”‚                                                 â”‚"
echo -e "â”‚      ${GREEN}â™¥ï¸ SuscrÃ­bete!${NC}                              â”‚"
echo -e "â”‚      ${GREEN}ğŸŒ https://www.youtube.com/mxhectorvega${NC}     â”‚"
echo -e "â”‚                                                 â”‚"
echo -e "â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯"
