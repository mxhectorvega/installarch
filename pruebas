#!/bin/bash
# Instalador para ArchLinux
# Clona el repositorio https://github.com/mxhectorvega/installarch

# Pantalla de bienvenida
whiptail --title "Bienvenido al Instalador" --msgbox "Bienvenido al instalador de scripts de mxhectorvega\nEl archivo de registro se almacenar치 en \$HOME/installarch.log" 10 60

# Funci칩n para registrar mensajes
log() {
    echo "$(date +'%Y-%m-%d %H:%M:%S') - $1" >> "$HOME/installarch.log"
}

# Limpiar archivo de registro anterior
rm -f "$HOME/installarch.log"
log "Iniciando instalador"

# Clonar repositorio
if git clone https://github.com/mxhectorvega/installarch "$HOME/installarch" 2>&1 | tee -a "$HOME/installarch.log"; then
    log "Repositorio clonado exitosamente"
else
    log "Error al clonar el repositorio"
    whiptail --title "Error" --msgbox "Error al clonar el repositorio. Revisa el archivo de registro para m치s detalles." 10 60
    exit 1
fi

# Validar y verificar compatibilidad
log "Validando compatibilidad de paquetes"
# Aqu칤 ir칤a tu l칩gica de validaci칩n de compatibilidad

# Funci칩n de retroceso en caso de fallo
rollback() {
    log "Iniciando rollback por error"
    # Aqu칤 ir칤a tu l칩gica de retroceso
    whiptail --title "Rollback" --msgbox "Se produjo un error. Realizando rollback..." 10 60
}

# Almacenar contrase침a root
root_password=$(whiptail --title "Contrase침a Root" --passwordbox "Introduce la contrase침a root:" 10 60 3>&1 1>&2 2>&3)
log "Contrase침a root almacenada"

# Pantalla de selecci칩n de script
scripts=$(find "$HOME/installarch" -maxdepth 1 -type f -executable -exec basename {} \; | awk '{print NR " " $0}')
selected_script=$(whiptail --title "Lista de Scripts" --menu "Selecciona un script para ejecutar" 20 78 12 $(echo "$scripts") 3>&1 1>&2 2>&3)

# Pantalla de instalaci칩n
{
    for step in $(seq 1 10); do
        sleep 1
        echo $((step * 10))
    done
} | whiptail --gauge "Instalando $selected_script..." 6 60 0

# Aqu칤 ir칤a la l칩gica de ejecuci칩n del script seleccionado
log "Ejecutando script seleccionado: $selected_script"

# Limpiar residuos y temporales
log "Limpiando residuos y temporales"
# Aqu칤 ir칤a tu l칩gica de limpieza

# Pantalla final
whiptail --title "Finalizar" --msgbox "鮫봺잺 Suscr칤bete! 游깷 https://www.youtube.com/mxhectorvega" 10 60

# Mostrar archivo de registro
whiptail --title "Registro" --textbox "$HOME/installarch.log" 20 80
