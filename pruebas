#!/usr/bin/env bash

# Actualizacion
sudo pacman -Syyu --noconfirm

# Paquetes basicos para KDE Plasma
sudo pacman -S acpi plocate usbutils ntfs-3g dosfstools pacman-contrib git curl wget vim nano fastfetch htop spectacle print-manager flatpak flatpak-kcm partitionmanager --noconfirm --needed

# Compatibilidad con impresoras
sudo pacman -S system-config-printer --noconfirm --needed
sudo pacman -S cups cups-pdf --noconfirm --needed
sudo gpasswd -a $(whoami) sys
sudo gpasswd -a $(whoami) wheel
sudo gpasswd -a $(whoami) root
sudo gpasswd -a $(whoami) lp
sudo systemctl enable --now cups

# Paru AUR Helper
cd ; git clone https://aur.archlinux.org/paru-bin.git ; cd paru-bin ; makepkg -si --noconfirm ; cd ; rm -rf paru-bin
sudo sed -i "s/#BottomUp/BottomUp/g" /etc/paru.conf
sudo pacman -Sy --noconfirm

# Paquetes de compatibilidad WIFI/WEBCAM MacBookPro 2011-2015 y MacBookAIR 2011-2017
sudo pacman -S dkms linux-headers broadcom-wl-dkms --noconfirm --needed

# Drivers impresora Epson L3210 multifuncional de tinta continua
paru -S epson-inkjet-printer-202101w facetimehd-firmware --noconfirm --needed

# FIX para el driver oficial de impresora L3210
sudo ln -s /opt/epson-inkjet-printer-202101w/cups/lib/filter/epson_inkjet_printer_filter /usr/lib/cups/filter/epson_inkjet_printer_filter

# Chaotic-AUR - Automated building repo for AUR packages
sudo pacman-key --recv-key 3056513887B78AEB --keyserver keyserver.ubuntu.com
sudo pacman-key --lsign-key 3056513887B78AEB
sudo pacman -U 'https://cdn-mirror.chaotic.cx/chaotic-aur/chaotic-keyring.pkg.tar.zst' 'https://cdn-mirror.chaotic.cx/chaotic-aur/chaotic-mirrorlist.pkg.tar.zst' --noconfirm

sudo tee -a /etc/pacman.conf <<EOF
[chaotic-aur]
Include = /etc/pacman.d/chaotic-mirrorlist
EOF

# Spotify sin publicidad (Chaotic REPO)
sudo pacman -S spotify-adblock-git --noconfirm --needed

# Gestor de software APPIMAGE
sudo pacman -S appimagelauncher --noconfirm --needed

# Preparador de USB booteable
sudo pacman -S ventoy-bin --noconfirm --needed

# habilitando bluetooth
sudo systemctl enable --now bluetooth.service

# Temas uniformes para software flatpak
sudo flatpak override --filesystem=/usr/share/themes
sudo flatpak override --filesystem=/usr/share/icons
sudo flatpak override --filesystem=xdg-config/gtk-2.0:ro
sudo flatpak override --filesystem=xdg-config/gtk-3.0:ro
sudo flatpak override --filesystem=xdg-config/gtk-4.0:ro

# Software personal en flatpak
flatpak install -y \
com.github.KRTirtho.Spotube \
com.github.iwalton3.jellyfin-media-player \
com.google.Chrome \
com.obsproject.Studio \
com.valvesoftware.Steam \
fr.handbrake.ghb \
io.itch.itch \
net.brinkervii.grapejuice \
net.davidotek.pupgui2 \
net.minetest.Minetest \
org.audacityteam.Audacity \
org.gimp.GIMP \
org.kde.gwenview \
org.kde.isoimagewriter \
org.kde.kcalc \
org.kde.kdenlive \
org.kde.okular \
org.libreoffice.LibreOffice \
org.mozilla.Thunderbird \
org.rncbc.qpwgraph \
org.ryujinx.Ryujinx \
org.supertuxproject.SuperTux \
org.telegram.desktop \
org.videolan.VLC

# ZRAM configuracion
sudo tee -a /etc/systemd/zram-generator.conf <<EOF
zram-size= ram
compression-algorithm = zsthd
EOF

# Fuentes bÃ¡sicas dakata
sudo pacman -S unicode-character-database gnu-free-fonts wqy-microhei noto-fonts-emoji ttf-{inconsolata,dejavu,hack,roboto,liberation,fira-{sans,code},cascadia-code,nerd-fonts-symbols} hunspell-es_mx zip un{zip,rar,arj} arj cpio p{7zip,bzip2,igz} l{zop,zip,rzip,ha} --needed --noconfirm

# Fuentes mxhectorvega
cd $HOME
mkdir -p $HOME/.local/share/fonts
cd
git clone https://github.com/mxhectorvega/tipografias
git clone https://github.com/mxhectorvega/tipografiaswin
cp -R $HOME/tipografias "$HOME"/.local/share/fonts
cp -R $HOME/tipografiaswin "$HOME"/.local/share/fonts
sleep 1
rm -rf $HOME/tipografias
rm -rf $HOME/tipografiaswin

# Mensaje final
sleep 1
printf '\n\n\tContribuye:\n\tmxhectorvega.com\n\n\n'