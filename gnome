#!/usr/bin/env bash

## Titulo: Instalación mínima del entorno de escritorio Gnome 4x.x consumiendo 400mb al inicio.
## Autor: Hector Iván Vega Zamudio
## Correo: mxhectorvega@gmail.com
## Link: https://github.com/mxhectorvega
## Versión:v3.0
## Fecha de actualización 03/07/2022
## Nota: El sistema de preferencia tuvo que haber sido instalado con la herramienta archinstall del liveUSB,
## Seleccionando el perfil MINIMO con todos los controladores de código abierto.

## Pacman configuraciones
clear 
printf '\n \nConfigurando gestor de paquetes Pacman...\n'
sleep 1
sudo sed -i "s/#Color/Color/g" /etc/pacman.conf 
sudo sed -i "s/#ParallelDownloads/ParallelDownloads/g" /etc/pacman.conf
sudo sed -i "38i ILoveCandy" /etc/pacman.conf

## Instalando repositorio Chaotic para no depender de YAY o PARU.
sleep 1
printf '\n \nInstalando repositorio Chaotic para no depender de YAY o PARU'
clear
sudo pacman-key --recv-key FBA220DFC880C036 --keyserver keyserver.ubuntu.com
sudo pacman-key --lsign-key FBA220DFC880C036
sudo pacman -U 'https://cdn-mirror.chaotic.cx/chaotic-aur/chaotic-keyring.pkg.tar.zst' 'https://cdn-mirror.chaotic.cx/chaotic-aur/chaotic-mirrorlist.pkg.tar.zst' --noconfirm
sudo tee -a /etc/pacman.conf <<EOF
[chaotic-aur]
Include = /etc/pacman.d/chaotic-mirrorlist
EOF
sudo pacman -Syyu --noconfirm

## Software basico para el usuario
clear
printf '\n \nInstalando paquetes basicos para el usuario...\n'
sleep 1
sudo pacman -S git make gcc htop vim ranger neofetch pacman-contrib man imv mpv zathura-pdf-mupdf xdg-user-dirs python python-pip python-pillow imagemagick --noconfirm --needed

# Paru AUR helper
clear 
printf '\n \nInstalando el gestor de paquetes Paru...\n'
sleep 1
cd ; git clone https://aur.archlinux.org/paru-bin.git ; cd paru-bin ; makepkg -si --noconfirm ; cd ; rm -rf paru-bin
sudo sed -i "s/#BottomUp/BottomUp/g" /etc/paru.conf 

## Instalando gestor de paquetes GUI
sudo pacman -S pamac --noconfirm

## clonando repositorios mxhectorvega
clear
printf '\n \nClonando repositorios mxhectorvega...\n'
sleep 1
git clone https://github.com/mxhectorvega/sway-arch
git clone https://github.com/mxhectorvega/tipografias
git clone https://github.com/mxhectorvega/temas

## copiando archivos y directorios
clear
printf '\n \nCopiando archivos y directorios...\n'
sleep 1
cp -rf $HOME/sway-arch/.bashrc "$HOME"
cp -rf $HOME/sway-arch/.vimrc "$HOME"

cp -rf $HOME/sway-arch/.config/ranger/ "$HOME"/.config/
cp -rf $HOME/sway-arch/.config/TWP.9.4.1.Chromium/ "$HOME"/.config/

cp -rf $HOME/sway-arch/.local/ "$HOME"

mkdir -p $HOME/.local/share/fonts/
cp -rf $HOME/tipografias/* "$HOME"/.local/share/fonts/

cp -rf $HOME/temas/.{icons,themes}/ "$HOME"
rm -rf "$HOME"/{sway-arch,tipografias,temas}/

## Paquetes minimos para que Gnome funcione
clear
printf '\n \nInstalando paquetes minimos para que Gnome funcione...\n'
sleep 1
sudo pacman -S gdm gnome-shell gnome-terminal nautilus gnome-tweaks gnome-calculator gnome-control-center polkit-gnome --noconfirm --needed
sudo pacman -S xdg-desktop-portal xdg-desktop-portal-gtk xdg-desktop-portal-gnome --noconfirm --needed
sudo pacman -S wireplumber --noconfirm --needed

## Fuentes basicas
clear
printf '\n \nInstalando fuentes basicas...\n'
sleep 1
sudo pacman -S ttf-{dejavu,hack,roboto,liberation} terminus-font wqy-microhei unicode-character-database noto-fonts noto-fonts-cjk --noconfirm --needed

## Instala gestor de extenciones gnome 42
clear 
printf '\n \nInstalando gestor de extensiones Gnome 42...\n'
sleep 1
git clone https://github.com/ekistece/GetExtensions.git
pip install ./GetExtensions --user
sleep 1
rm -rf "$HOME"/GetExtensions/

## instalando paquetes personalizados para el usuario
clear 
printf '\n \nInstalando paquetes personalizados para el usuario...\n'
sleep 1
sudo pacman -S visual-studio-code-bin microsoft-edge-stable-bin freeoffice telegram-desktop --noconfirm
sudo pacman -S gimp audacity kdenlive inkscape obs-studio --noconfirm
sudo pacman -S teamviewer anydesk-bin --noconfirm
sudo pacman -S steam --noconfirm

## borrando directorios no necesarios
clear 
printf '\n \nBorrando directorio GO...\n'
sleep 1
rm -rf "$HOME"/go/

# Cambiando de fuente y wallpaper ligthDM
clear 
printf '\n \nOptimizando ZRAM con compresion ZSTD...\n'
sleep 1
sudo tee /etc/systemd/zram-generator.conf <<EOF
[zram0]
zram-size= ram
swap-priority = 32767
compression-algorithm = zstd
EOF

## habilitando bluetooth
clear 
printf '\n \nHabilitando bluetooth...\n'
sleep 1
sudo systemctl enable --now bluetooth.service


## crear direciorios de usuario
clear 
printf '\n \nCreando direciorios de usuario...\n'
sleep 1
xdg-user-dirs-update

## Mensaje final
clear
sleep 1
printf '\n \nConfiguraciones aplicadas!'
sleep 1
printf '\n \nContribuye paypal.me/hivz'
sleep 3

## Habilitando servicio de pantalla de inicio de sesion
clear
printf '\n \nIniciando pantalla de inicio de session....'
sleep 1
sudo systemctl enable --now gdm
