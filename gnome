#!/usr/bin/env bash

# Instalación del entorno de escritorio Gnome 4.1.x minimal
# Repositorio: https://github.com/mxhectorvega/installarch
# Ejecucion: bash <(curl -L is.gd/mxignome)
# Fecha de actualización 04/02/2025
# Versión: 7.3

# Notas: El sistema debio haberse instalado de preferencia con la herramienta ArchInstall desde ArchISO seleccionado el perfil minimal (sin entorno de escritorio).

# Actualización
sudo pacman -Sy --noconfirm

# Internos para el SO
sudo pacman -S openssh seahorse acpi plocate usbutils ntfs-3g dosfstools flatpak pacman-contrib fuse xdg-user-dirs rsync nano --noconfirm --needed

# Para ejecutar desde la terminal
sudo pacman -S fastfetch git curl wget nvtop htop vim less man speedtest-cli --noconfirm --needed 

# Paquetes mínimos para que Gnome funcione
sudo pacman -S gdm gnome-shell nautilus gnome-control-center gnome-software gnome-console gnome-disk-utility polkit-gnome --noconfirm --needed
sudo pacman -S xdg-desktop-portal xdg-desktop-portal-gnome --noconfirm --needed

# Tema GTK3 de libadwaita
sudo pacman -S adw-gtk-theme --noconfirm --needed
flatpak install org.gtk.Gtk3theme.adw-gtk3 org.gtk.Gtk3theme.adw-gtk3-dark

# Crear directorios de usuario en español
xdg-user-dirs-update

# Instalar administrador de impresoras y establecer permisos en el sistema
sudo pacman -S system-config-printer cups --noconfirm --needed
sudo gpasswd -a $(whoami) sys
sudo gpasswd -a $(whoami) wheel
sudo gpasswd -a $(whoami) root
sudo gpasswd -a $(whoami) lp

# Iniciar los servicios de impresion
sudo systemctl enable --now cups

# Creando enlaces simbolicos para askpass package
sudo ln -s /usr/lib/seahorse/ssh-askpass /usr/lib/ssh/ssh-askpass

# ZRAM configuracion
sudo tee -a /etc/systemd/zram-generator.conf <<EOF
zram-size= ram
compression-algorithm = zstd
EOF

# Fuentes mxhectorvega
cd $HOME
git clone https://github.com/mxhectorvega/tipografias
git clone https://github.com/mxhectorvega/tipografiaswin
mkdir -p $HOME/.local/share/fonts
sleep 1
cp -R $HOME/tipografias "$HOME"/.local/share/fonts
cp -R $HOME/tipografiaswin "$HOME"/.local/share/fonts
rm -rf $HOME/tipografias
rm -rf $HOME/tipografiaswin

# Driver bluetooth
sudo pacman -S bluez{,-utils} --needed --noconfirm

# Habilitando servicio de bluetooth
sudo systemctl enable --now bluetooth.service

# Instalacion de Java por si acaso lo requiere el usuario domestico
sudo pacman -S jre8-openjdk --noconfirm --needed

# Mensaje final
sleep 0.1
clear
sleep 0.1
printf '\n\n\n\n\n\n\n\n\t\t\t\t\t\t\t♥️ Suscríbete!\n\n\t\t\t\t\t\t\t🌐 https://www.youtube.com/mxhectorvega\n\n\n\n\n\n\n\n\n\n'
sleep 3

# Habilitando servicio de pantalla de inicio de sesión
clear
printf 'Activando display manager.'
sleep 0.1
clear
printf 'Activando display manager..'
sleep 0.1
clear
printf 'Activando display manager...'
sleep 0.1
clear
printf 'Activando display manager....'
sleep 0.1
clear
printf 'Activando display manager.....'
sleep 0.1
clear
printf 'Activando display manager......'
sleep 0.1
clear
printf 'Activando display manager.......'
sleep 0.1
clear
printf 'Activando display manager........'
sleep 1
sudo systemctl enable --now gdm

